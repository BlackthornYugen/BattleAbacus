<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>New Character</title>
</head>
<body>
        <header data-role="header" class="heading">
            <section data-role="content">
                <a href="index.html" data-prefetch data-transition="slide" data-direction="reverse">
                    <img border="0" src="images/h-menu.svg"></a>
                <h1>New Character</h1>
            </section>
        </header>
        <section data-role="content">
            <input type='file' onchange="readURL(this);" class="ui-input-clear-hidden" />
            <br>
            <label for="imageFrame">Avatar:</label>
            <section style="max-width: 100%; padding: 5px; border: 1px solid black; overflow: hidden;">
                <img id="imageFrame" style="max-width: 100%; display: block; margin: auto;" />
            </section>
            <br>
            <form id="newCharForm">
                <input type="hidden" name="imageData">
                <label for="charName" required>Name:</label>
                <input type="text" name="charName" id="charName">
                <label for="charClass">Class:</label>
                <select name="charClass" id="charClass" data-native-menu="false">
                    <option value="choose-one" data-placeholder="true">Choose one...</option>
                    <option value="sor">Sorcerer</option>
                    <option value="wiz">Wizard</option>
                    <option value="cleric">Cleric</option>
                    <option value="druid">Druid</option>
                    <option value="ranger">Ranger</option>
                    <option value="bard">Bard</option>
                    <option value="paladin">Paladin</option>
                    <option value="alchemist">Alchemist</option>
                    <option value="summoner">Summoner</option>
                    <option value="witch">Witch</option>
                    <option value="inquisitor">Inquisitor</option>
                    <option value="oracle">Oracle</option>
                </select>
            </form>
            <section data-role="controlgroup" data-type="horizontal">
                <button onclick="$('input').trigger('click')" >Set Avatar</button>
                <a href="index.html" data-role="button" id="saveChar">Save</a>
                <a href="index.html" data-role="button">Cancel</a>
            </section>
        </section>
        <script>
            function readURL(input)
            {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $("#imageFrame").attr("src", e.target.result);
                        var ctx = document.createElement("canvas").getContext('2d');
                        ctx.canvas.height = 300;
                        ctx.drawImage($("#imageFrame")[0],0,0);
                        $("input[name=imageData]").val(ctx.canvas.toDataURL());
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            function createChar(event) {
                var $form =  $("#newCharForm");
                var name = $form.find("#charName").val().trim();
                if(name !== "") {
                    var image = "http://placehold.it/60.png/F76DD2/fff";
                    characters.push(new Character(name));
                    var imageData = $form.find("input[name=imageData]").val();
                    if(imageData !== "") {
                        localStorage.setItem(name, imageData);
                    }
                } else {
                    alert("Please enter a valid name");
                    event.preventDefault();
                }
            }

            $("#saveChar").on("tap", createChar);
        </script>
</body>
</html>